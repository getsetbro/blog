<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Zero to website on Node in Azure | getsetbro blog</title>
    <meta name="description" content="Official blog area of getsetbro">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.d6130bc8.css" as="style"><link rel="preload" href="/blog/assets/js/app.5fb0c628.js" as="script"><link rel="preload" href="/blog/assets/js/9.7e4fefd5.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.f4b0a49c.js"><link rel="prefetch" href="/blog/assets/js/11.7e4316f2.js"><link rel="prefetch" href="/blog/assets/js/2.16669377.js"><link rel="prefetch" href="/blog/assets/js/3.b8e12a31.js"><link rel="prefetch" href="/blog/assets/js/4.00dad9a6.js"><link rel="prefetch" href="/blog/assets/js/5.3103a4a4.js"><link rel="prefetch" href="/blog/assets/js/6.0f0585ec.js"><link rel="prefetch" href="/blog/assets/js/7.922575b9.js"><link rel="prefetch" href="/blog/assets/js/8.46a45450.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.d6130bc8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">getsetbro blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <!----> </div> <div class="page"> <div class="content"><h1 id="zero-to-website-on-node-in-azure"><a href="#zero-to-website-on-node-in-azure" aria-hidden="true" class="header-anchor">#</a> Zero to website on Node in Azure</h1> <h2 id="go-from-having-no-previous-setup-to-deploying-a-simple-node-website"><a href="#go-from-having-no-previous-setup-to-deploying-a-simple-node-website" aria-hidden="true" class="header-anchor">#</a> Go from having no previous setup to deploying a simple Node website</h2> <p>These are a set of steps for going from having nothing setup to a simple site built with node and hosted in the cloud. This simple site will have one route to the index.html page. The html page will point to a static hosted image file. It will also call an API which pulls data from a database ( DocumentDB but with the MongoDB API ).</p> <h2 id="prep-setup"><a href="#prep-setup" aria-hidden="true" class="header-anchor">#</a> Prep / Setup</h2> <h3 id="node-npm-and-hapi"><a href="#node-npm-and-hapi" aria-hidden="true" class="header-anchor">#</a> Node, NPM, and Hapi</h3> <ul><li>Install the latest stable version of Node from <a href="https://nodejs.org" target="_blank" rel="noopener noreferrer">https://nodejs.org<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</li> <li>Create a folder named 'dev' in your Documents folder.</li> <li>Open your command-line tool to the 'dev' folder.</li> <li>Type <code>npm init</code> to initialize by creating a 'package.json' file.</li> <li><ul><li>Press ENTER through all the prompts to select the defaults.</li></ul></li> <li>Add Hapi by entering <code>npm install --save Hapi</code></li></ul> <p><em>The '--save' (or '-S') adds it to the 'package.json' file as a dependency for this app. This will tell cloud service, or any dev, what packages are needed to build this project.</em></p> <h2 id="create-the-app"><a href="#create-the-app" aria-hidden="true" class="header-anchor">#</a> Create the app</h2> <h3 id="hapi"><a href="#hapi" aria-hidden="true" class="header-anchor">#</a> Hapi</h3> <blockquote><p>Competitors to Hapi are Express, Koa, Lazo, Restify - I am keeping a list <a href="https://github.com/getsetbro/csv-files/blob/master/node-tools.csv" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <ul><li>Create a 'index.js' file in the 'dev' folder. This can also be 'server.js' or 'app.js'.</li> <li>Copy and paste into 'index.js' the first example from <a href="https://hapijs.com/" target="_blank" rel="noopener noreferrer">https://hapijs.com/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>In the terminal window, that is open to the 'dev' folder type <code>node .</code>. This tells Node to run the app.</li> <li>In a browser go to 'http://localhost:8000/hello' to view the app.</li> <li>Use <code>ctrl C</code>, in the terminal window, to shut down the app.</li> <li>Next lets change the server connection port to be ready for deployment to a cloud service.</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>server<span class="token punctuation">.</span><span class="token function">connection</span><span class="token punctuation">(</span><span class="token punctuation">{</span> port<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">7070</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><em>I am dropping localhost because it's my system knows that and azure won't want it. If that breaks things for you than put it back.</em></p> <h3 id="serving-html-and-static-files"><a href="#serving-html-and-static-files" aria-hidden="true" class="header-anchor">#</a> Serving HTML and static files</h3> <ul><li>Add a 'views' folder to the 'dev' folder.</li> <li>Add an 'index.html' file with HTML code such as:</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Hi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    Hello
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><em>Be sure to use a <strong>web text editor</strong>, TextEdit gave me issues at this step.</em></p> <ul><li>With NPM install the node modules 'vision' and 'handlebars':</li></ul> <div class="language- extra-class"><pre class="language-text"><code>  npm install -S vision &amp;&amp; npm install -S handlebars
</code></pre></div><ul><li>Change the 'routes' block to this:</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>server<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;vision&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  server<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    method<span class="token punctuation">:</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>
    handler<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> reply<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      reply<span class="token punctuation">.</span><span class="token function">view</span><span class="token punctuation">(</span><span class="token string">&quot;index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  server<span class="token punctuation">.</span><span class="token function">views</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    engines<span class="token punctuation">:</span> <span class="token punctuation">{</span> html<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;handlebars&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    relativeTo<span class="token punctuation">:</span> __dirname<span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> <span class="token string">&quot;views&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>'Vision' is &quot;Templates rendering support for hapi.js&quot; from the core team <a href="https://github.com/hapijs/vision" target="_blank" rel="noopener noreferrer">https://github.com/hapijs/vision<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <ul><li>Now start the app from the terminal window with <code>node .</code>.</li> <li>Check it out at 'http://localhost:7070/'. You should see 'Hello' from your index view.</li></ul> <h3 id="serve-up-static-files"><a href="#serve-up-static-files" aria-hidden="true" class="header-anchor">#</a> Serve up static files</h3> <ul><li>Create a folder named 'public'.</li> <li>Add an image file named 'logo.png'.</li> <li>With NPM install inert: <code>npm install -S inert</code></li></ul> <blockquote><p>'Inert' is static file and directory handlers for hapi.js from the core team <a href="https://github.com/hapijs/inert" target="_blank" rel="noopener noreferrer">https://github.com/hapijs/inert<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <ul><li>In the 'index.js' file add the following block above this line 'server.register(require('vision')...':</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>server<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;inert&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  server<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    method<span class="token punctuation">:</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> <span class="token string">&quot;/{file*}&quot;</span><span class="token punctuation">,</span>
    handler<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      directory<span class="token punctuation">:</span> <span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">&quot;public&quot;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>In the BODY of the 'index.html' file add the logo image</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/img/logo.png<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><ul><li>Now start the app from the command-line tool with <code>node .</code>.</li> <li>Check it out at 'http://localhost:7070/'. You should see the image in the web page.</li></ul> <h2 id="deploying-to-a-cloud-service"><a href="#deploying-to-a-cloud-service" aria-hidden="true" class="header-anchor">#</a> Deploying to a cloud service</h2> <p>In this demo we will be deploying to Azure but it could any PaaS (Platform as a Service). I am keeping a list <a href="https://github.com/getsetbro/csv-files/blob/master/node-tools.csv" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="azure"><a href="#azure" aria-hidden="true" class="header-anchor">#</a> Azure</h3> <ul><li>In the Azure portal create a NEW Web App. Give it a name, a Resource Group, and a Service Plan.</li> <li>When it is created click the Quickstart button in the Web App properties. Choose Node and then 'Local Source Control'.</li> <li>Click the link to configure credentials. Make a Username and Password.</li> <li>Click to the Deployment Options. Choose 'Local Git Repo'. Click OK.</li> <li>Find the GIT URL on the properties page of your Web App.</li></ul> <h3 id="git"><a href="#git" aria-hidden="true" class="header-anchor">#</a> Git</h3> <ul><li>Install Git from <a href="https://git-scm.com/" target="_blank" rel="noopener noreferrer">https://git-scm.com/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> or see all the ways <a href="https://www.atlassian.com/git/tutorials/install-git" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>In command-line tool type <code>git init</code> to initialize this folder as a git repo.</li> <li>Add a .gitignore file to your repo paste these two items into it:</li></ul> <div class="language- extra-class"><pre class="language-text"><code>  node_modules
  .DS_Store
</code></pre></div><ul><li>Type <code>git add -A</code> to add all files to the git repo.</li> <li>Type <code>git commit -m &quot;Hello Azure App Service&quot;</code> to commit the changes.</li> <li>Type <code>git remote add azure https://USERNAME@WEBAPPNAME.scm.azurewebsites.net:443/WEBAPPNAME.git</code></li> <li>Type <code>git push azure master</code></li></ul> <p>The official MS Docs with more info can be found <a href="https://docs.microsoft.com/en-us/azure/app-service-web/app-service-deploy-local-git" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="add-a-database"><a href="#add-a-database" aria-hidden="true" class="header-anchor">#</a> Add a Database</h2> <h3 id="documentdb-but-really-mongodb-but-really-documentdb"><a href="#documentdb-but-really-mongodb-but-really-documentdb" aria-hidden="true" class="header-anchor">#</a> DocumentDB but really MongoDB but really DocumentDB</h3> <ul><li>In the Azure portal Click NEW &gt; DATABASES &gt; NOSQL/DOCUMENTDB.</li> <li>Give it a name.</li> <li>Click to make it use the MongDB API.</li> <li>Choose a Resource Group and Location.</li> <li>Click Ok.</li> <li>In the properties click the Quickstart button. Choose the Node.js tab and find the connection string.</li></ul> <h3 id="create-an-api-with-i-o-to-the-database"><a href="#create-an-api-with-i-o-to-the-database" aria-hidden="true" class="header-anchor">#</a> Create an API with I/O to the database</h3> <ul><li>First install the 'hapi-mongodb' package with <code>npm install -S hapi-mongodb</code>.</li> <li>In the 'index.js' find the block that starts with 'server.start(err =&gt; {...'</li> <li>Instead of that whole block paste this one but include your Database Connection String:</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> MongoDB <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;hapi-mongodb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> dbOpts <span class="token operator">=</span> <span class="token punctuation">{</span>
  url<span class="token punctuation">:</span> <span class="token string">&quot;DB_CONNECTION_STRING_HERE&quot;</span><span class="token punctuation">,</span>
  settings<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    db<span class="token punctuation">:</span> <span class="token punctuation">{</span> native_parser<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    method<span class="token punctuation">:</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> <span class="token string">&quot;/allbooks&quot;</span><span class="token punctuation">,</span>
    config<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      handler<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> reply<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> db <span class="token operator">=</span> request<span class="token punctuation">.</span>server<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span><span class="token string">&quot;hapi-mongodb&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>db<span class="token punctuation">;</span>
        <span class="token function">reply</span><span class="token punctuation">(</span>
          db
            <span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;books&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      cors<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    method<span class="token punctuation">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> <span class="token string">&quot;/addbook&quot;</span><span class="token punctuation">,</span>
    config<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      handler<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> reply<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> db <span class="token operator">=</span> request<span class="token punctuation">.</span>server<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span><span class="token string">&quot;hapi-mongodb&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>db<span class="token punctuation">;</span>
        db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;books&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span>
          <span class="token punctuation">{</span> title<span class="token punctuation">:</span> request<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>title <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> title<span class="token punctuation">:</span> request<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>title <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> upsert<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">reply</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      cors<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">{</span> register<span class="token punctuation">:</span> MongoDB<span class="token punctuation">,</span> options<span class="token punctuation">:</span> dbOpts <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  server<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>server<span class="token punctuation">.</span>info<span class="token punctuation">.</span>uri<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>Let's walk through what the above code does.</li> <li><ul><li>It 'requires' the <code>hapi-mongodb</code> package.</li></ul></li> <li><ul><li>It includes the DB connection string from azure</li></ul></li> <li><ul><li>It creates two routes. One for getting all records from the database and one for adding records to the database.</li></ul></li> <li><ul><li>Then it starts the server after registering the MongoDB module with an options object.</li></ul></li></ul> <h3 id="use-the-api-from-the-view"><a href="#use-the-api-from-the-view" aria-hidden="true" class="header-anchor">#</a> Use the API from the view</h3> <ul><li>In the 'index.html' file add this jQuery script under the IMG tag:</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&lt;script src=&quot;https://code.jquery.com/jquery-3.2.0.min.js&quot;&gt;&lt;/script&gt;
</code></pre></div><ul><li>Then add this block inside of a new SCRIPT block:</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> unique <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> sendr <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/addbook&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&quot;Title &quot;</span> <span class="token operator">+</span> unique <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sendr<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  $<span class="token punctuation">.</span><span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">&quot;/allbooks&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> arr <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&quot;&lt;li&gt;&quot;</span> <span class="token operator">+</span> o<span class="token punctuation">.</span>title <span class="token operator">+</span> <span class="token string">&quot;&lt;/li&gt;&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;ol&gt;&quot;</span> <span class="token operator">+</span> arr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;&lt;/ol&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>The above code sends off a request that tells the API to create a new record in the database. When that request is complete it asks the api to get all records and appends them to the BODY.</li></ul> <hr> <p>Comments and questions are here: <a href="https://github.com/getsetbro/blog/issues/17" target="_blank" rel="noopener noreferrer">/blog/issues/17<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">1/7/2019, 10:15:34 PM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/blog/assets/js/app.5fb0c628.js" defer></script><script src="/blog/assets/js/9.7e4fefd5.js" defer></script>
  </body>
</html>
